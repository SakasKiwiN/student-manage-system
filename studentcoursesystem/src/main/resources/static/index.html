<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å­¦ç”Ÿé€‰è¯¾ç³»ç»Ÿ - ç™»å½•</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/login.css">
</head>
<body>
<div class="login-container">
    <div class="login-card">
        <div class="login-header">
            <div class="system-logo">ğŸ“</div>
            <h1 class="system-title">å­¦ç”Ÿé€‰è¯¾ç³»ç»Ÿ</h1>
            <p class="system-subtitle">Student Course Selection System</p>
        </div>

        <div class="error-message" id="errorMessage"></div>

        <form class="login-form" id="loginForm">
            <div class="form-group">
                <label for="username">ç”¨æˆ·å</label>
                <div class="input-with-icon">
                    <span class="input-icon">ğŸ‘¤</span>
                    <input type="text"
                           id="username"
                           name="username"
                           class="form-control"
                           placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                           required
                           autocomplete="username">
                </div>
            </div>

            <div class="form-group">
                <label for="password">å¯†ç </label>
                <div class="input-with-icon">
                    <span class="input-icon">ğŸ”’</span>
                    <input type="password"
                           id="password"
                           name="password"
                           class="form-control"
                           placeholder="è¯·è¾“å…¥å¯†ç "
                           required
                           autocomplete="current-password">
                </div>
            </div>

            <div class="form-options">
                <label class="remember-me">
                    <input type="checkbox" id="rememberMe">
                    è®°ä½å¯†ç 
                </label>
                <a href="#" class="forgot-password">å¿˜è®°å¯†ç ï¼Ÿ</a>
            </div>

            <button type="submit" class="login-btn" id="loginBtn">
                <span class="spinner"></span>
                <span class="btn-text">ç™»å½•</span>
            </button>
        </form>

        <div class="role-info">
            <h4>ç³»ç»Ÿè§’è‰²è¯´æ˜</h4>
            <ul class="role-list">
                <li><strong>ç³»ç»Ÿç®¡ç†å‘˜:</strong> sysadmin</li>
                <li><strong>å­¦é™¢ç®¡ç†å‘˜:</strong> cs_admin / ee_admin</li>
                <li><strong>æ•™å¸ˆ:</strong> teacher_wang / teacher_li / teacher_zhang</li>
                <li><strong>å­¦ç”Ÿ:</strong> 2021001 / 2021002 / 2021003 / 2021004</li>
            </ul>
            <p style="margin-top: 10px; font-size: 12px; color: #666;">
                æ‰€æœ‰è´¦å·çš„é»˜è®¤å¯†ç ï¼š<strong>123456</strong>
            </p>
        </div>

        <div class="copyright">
            <p>&copy; 2025 å­¦ç”Ÿé€‰è¯¾ç³»ç»Ÿ. All rights reserved.</p>
        </div>
    </div>
</div>

<!-- JavaScript -->
<script src="/js/common.js"></script>
<script src="/js/api.js"></script>
<script src="/js/auth.js"></script>
<script>
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        const loginForm = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn');
        const errorMessage = document.getElementById('errorMessage');
        const usernameInput = document.getElementById('username');
        const passwordInput = document.getElementById('password');
        const rememberMe = document.getElementById('rememberMe');

        // ä»æœ¬åœ°å­˜å‚¨åŠ è½½è®°ä½çš„ç”¨æˆ·å
        const savedUsername = StorageUtils.getLocal('rememberedUsername');
        if (savedUsername) {
            usernameInput.value = savedUsername;
            rememberMe.checked = true;
            passwordInput.focus();
        } else {
            usernameInput.focus();
        }

        // éšè—é”™è¯¯æ¶ˆæ¯
        function hideError() {
            errorMessage.classList.remove('show');
        }

        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.add('show');
        }

        // è®¾ç½®ç™»å½•æŒ‰é’®çŠ¶æ€
        function setLoginButtonState(loading) {
            if (loading) {
                loginBtn.classList.add('loading');
                loginBtn.disabled = true;
            } else {
                loginBtn.classList.remove('loading');
                loginBtn.disabled = false;
            }
        }

        // è¡¨å•æäº¤å¤„ç†
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            hideError();

            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();

            if (!username || !password) {
                showError('è¯·å¡«å†™å®Œæ•´çš„ç™»å½•ä¿¡æ¯');
                return;
            }

            setLoginButtonState(true);

            try {
                const result = await AuthManager.login(username, password);

                if (result.success) {
                    // è®°ä½ç”¨æˆ·å
                    if (rememberMe.checked) {
                        StorageUtils.setLocal('rememberedUsername', username);
                    } else {
                        StorageUtils.removeLocal('rememberedUsername');
                    }

                    Utils.showMessage('ç™»å½•æˆåŠŸï¼Œæ­£åœ¨è·³è½¬...', 'success');

                    // å»¶è¿Ÿè·³è½¬ä»¥æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
                    setTimeout(() => {
                        window.location.href = '/main.html';
                    }, 1000);
                } else {
                    showError(result.message || 'ç™»å½•å¤±è´¥');
                }
            } catch (error) {
                console.error('Login error:', error);
                showError('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
            } finally {
                setLoginButtonState(false);
            }
        });

        // è¾“å…¥æ¡†å˜åŒ–æ—¶éšè—é”™è¯¯
        usernameInput.addEventListener('input', hideError);
        passwordInput.addEventListener('input', hideError);

        // å›è½¦é”®å¿«æ·ç™»å½•
        usernameInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                passwordInput.focus();
            }
        });

        passwordInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                loginForm.dispatchEvent(new Event('submit'));
            }
        });

        // å¿˜è®°å¯†ç åŠŸèƒ½
        document.querySelector('.forgot-password').addEventListener('click', function(e) {
            e.preventDefault();
            Utils.showMessage('è¯·è”ç³»ç³»ç»Ÿç®¡ç†å‘˜é‡ç½®å¯†ç ', 'info');
        });
    });
</script>
</body>
</html>