<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯¾ä»¶ç®¡ç† - å­¦ç”Ÿé€‰è¯¾ç³»ç»Ÿ</title>
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
<div class="main-layout">
    <aside class="sidebar" id="sidebar"></aside>

    <main class="main-content">
        <header class="top-navbar">
            <div class="navbar-left">
                <button class="sidebar-toggle" id="sidebarToggle">â˜°</button>
                <nav class="breadcrumb">
                    <span class="breadcrumb-item">æ•™å­¦ç®¡ç†</span>
                    <span class="breadcrumb-separator">/</span>
                    <span class="breadcrumb-item active">è¯¾ä»¶ç®¡ç†</span>
                </nav>
            </div>
            <div class="navbar-right" id="navbarRight"></div>
        </header>

        <div class="page-content">
            <div class="page-header">
                <h1 class="page-title">è¯¾ä»¶ç®¡ç†</h1>
                <p class="page-description">ä¸Šä¼ å’Œç®¡ç†æ‚¨çš„è¯¾ç¨‹æ•™å­¦èµ„æ–™</p>
            </div>

            <!-- è¯¾ç¨‹é€‰æ‹© -->
            <div class="card">
                <div class="card-header">
                    <h5>é€‰æ‹©è¯¾ç¨‹</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">æˆ‘çš„è¯¾ç¨‹</label>
                                <select class="form-select" id="courseSelect">
                                    <option value="">è¯·é€‰æ‹©è¯¾ç¨‹</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="form-label">&nbsp;</label>
                                <div>
                                    <button class="btn btn-success" id="uploadBtn" disabled>
                                        ğŸ“ ä¸Šä¼ è¯¾ä»¶
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- è¯¾ç¨‹ä¿¡æ¯æ˜¾ç¤º -->
                    <div id="courseInfo" style="display: none;">
                        <hr>
                        <div class="row">
                            <div class="col-md-3">
                                <p><strong>è¯¾ç¨‹ç¼–ç ï¼š</strong><span id="courseCode">-</span></p>
                            </div>
                            <div class="col-md-3">
                                <p><strong>å­¦åˆ†ï¼š</strong><span id="courseCredits">-</span></p>
                            </div>
                            <div class="col-md-3">
                                <p><strong>é€‰è¯¾å­¦ç”Ÿï¼š</strong><span id="studentCount">-</span></p>
                            </div>
                            <div class="col-md-3">
                                <p><strong>è¯¾ä»¶æ•°é‡ï¼š</strong><span id="coursewareCount">-</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- è¯¾ä»¶åˆ—è¡¨ -->
            <div class="card" id="coursewareCard" style="display: none;">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5>è¯¾ä»¶åˆ—è¡¨</h5>
                    <div>
                        <span class="text-muted" id="totalFileSize">æ€»å¤§å°: 0 MB</span>
                    </div>
                </div>
                <div class="card-body">
                    <div id="coursewareLoadingContainer" class="loading">
                        <div class="spinner"></div>
                        <p>åŠ è½½è¯¾ä»¶æ•°æ®ä¸­...</p>
                    </div>

                    <div id="coursewareContainer" style="display: none;"></div>

                    <div id="coursewareEmptyContainer" style="display: none; text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“</div>
                        <h5>è¿˜æ²¡æœ‰ä¸Šä¼ ä»»ä½•è¯¾ä»¶</h5>
                        <p class="text-muted">ç‚¹å‡»ä¸Šä¼ æŒ‰é’®å¼€å§‹æ·»åŠ è¯¾ç¨‹èµ„æ–™</p>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- ä¸Šä¼ è¯¾ä»¶æ¨¡æ€æ¡† -->
<div class="modal" id="uploadModal">
    <div class="modal-dialog">
        <div class="modal-header">
            <h5 class="modal-title">ä¸Šä¼ è¯¾ä»¶</h5>
            <button type="button" class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label class="form-label">è¯¾ä»¶æ ‡é¢˜ *</label>
                    <input type="text"
                           class="form-control"
                           id="coursewareTitle"
                           name="title"
                           required
                           placeholder="è¯·è¾“å…¥è¯¾ä»¶æ ‡é¢˜">
                </div>
                <div class="form-group">
                    <label class="form-label">é€‰æ‹©æ–‡ä»¶ *</label>
                    <input type="file"
                           class="form-control"
                           id="coursewareFile"
                           name="file"
                           required
                           accept=".pdf,.doc,.docx,.ppt,.pptx,.txt,.zip,.rar">
                    <small class="text-muted">
                        æ”¯æŒæ ¼å¼ï¼šPDFã€DOCã€DOCXã€PPTã€PPTXã€TXTã€ZIPã€RARï¼ˆæœ€å¤§50MBï¼‰
                    </small>
                </div>
                <div class="form-group" id="filePreview" style="display: none;">
                    <label class="form-label">æ–‡ä»¶é¢„è§ˆ</label>
                    <div class="file-preview-card">
                        <div class="file-icon" id="previewIcon">ğŸ“„</div>
                        <div class="file-info">
                            <div class="file-name" id="previewName">-</div>
                            <div class="file-size" id="previewSize">-</div>
                        </div>
                    </div>
                </div>
            </form>
            <div class="upload-progress" id="uploadProgress" style="display: none;">
                <div class="progress">
                    <div class="progress-bar" id="progressBar" style="width: 0%">0%</div>
                </div>
                <p class="text-center mt-2" id="progressText">å‡†å¤‡ä¸Šä¼ ...</p>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
            <button type="button" class="btn btn-primary" id="confirmUploadBtn">ä¸Šä¼ </button>
        </div>
    </div>
</div>

<!-- ç¼–è¾‘è¯¾ä»¶æ¨¡æ€æ¡† -->
<div class="modal" id="editModal">
    <div class="modal-dialog">
        <div class="modal-header">
            <h5 class="modal-title">ç¼–è¾‘è¯¾ä»¶</h5>
            <button type="button" class="modal-close" onclick="closeEditModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="editForm">
                <input type="hidden" id="editCoursewareId">
                <div class="form-group">
                    <label class="form-label">è¯¾ä»¶æ ‡é¢˜ *</label>
                    <input type="text"
                           class="form-control"
                           id="editTitle"
                           name="title"
                           required>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" onclick="closeEditModal()">å–æ¶ˆ</button>
            <button type="button" class="btn btn-primary" id="saveEditBtn">ä¿å­˜</button>
        </div>
    </div>
</div>

<script src="/js/common.js"></script>
<script src="/js/api.js"></script>
<script src="/js/auth.js"></script>
<script>
    // é¡µé¢çŠ¶æ€
    let currentTeacher = null;
    let myCourses = [];
    let selectedCourse = null;
    let coursewares = [];

    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        initializePage();
    });

    // ç›‘å¬ç”¨æˆ·è®¤è¯äº‹ä»¶
    window.addEventListener('userAuthenticated', function(event) {
        loadPageData();
        bindEvents();
    });

    // åˆå§‹åŒ–é¡µé¢
    async function initializePage() {
        if (!AuthManager.isTeacher()) {
            Utils.showMessage('æƒé™ä¸è¶³ï¼Œæ­£åœ¨è·³è½¬...', 'warning');
            setTimeout(() => {
                PageAuth.redirectToRolePage();
            }, 1500);
            return;
        }
    }

    // åŠ è½½é¡µé¢æ•°æ®
    async function loadPageData() {
        try {
            // è·å–å½“å‰æ•™å¸ˆä¿¡æ¯
            const teacherResponse = await API.Teacher.getCurrent();
            if (teacherResponse.code === 200) {
                currentTeacher = teacherResponse.data;
                await loadMyCourses();
                renderCourseSelect();

                // æ£€æŸ¥URLå‚æ•°ä¸­æ˜¯å¦æŒ‡å®šäº†è¯¾ç¨‹ID
                const courseId = Utils.getUrlParam('courseId');
                if (courseId && myCourses.some(c => c.id == courseId)) {
                    document.getElementById('courseSelect').value = courseId;
                    await loadCourseCoursewares(courseId);
                }
            }
        } catch (error) {
            console.error('Load page data error:', error);
            Utils.showMessage('åŠ è½½é¡µé¢æ•°æ®å¤±è´¥', 'danger');
        }
    }

    // åŠ è½½æˆ‘çš„è¯¾ç¨‹
    async function loadMyCourses() {
        try {
            if (!currentTeacher) return;

            const response = await API.Course.getByTeacher(currentTeacher.id);
            if (response.code === 200) {
                myCourses = response.data || [];
            }
        } catch (error) {
            console.error('Load my courses error:', error);
            throw error;
        }
    }

    // æ¸²æŸ“è¯¾ç¨‹é€‰æ‹©å™¨
    function renderCourseSelect() {
        const courseSelect = document.getElementById('courseSelect');
        courseSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è¯¾ç¨‹</option>';

        myCourses.forEach(course => {
            const option = document.createElement('option');
            option.value = course.id;
            option.textContent = `${course.name} (${course.courseCode})`;
            courseSelect.appendChild(option);
        });
    }

    // åŠ è½½è¯¾ç¨‹è¯¾ä»¶
    async function loadCourseCoursewares(courseId) {
        try {
            selectedCourse = myCourses.find(c => c.id == courseId);
            if (!selectedCourse) return;

            const loadingContainer = document.getElementById('coursewareLoadingContainer');
            const coursewareContainer = document.getElementById('coursewareContainer');
            const emptyContainer = document.getElementById('coursewareEmptyContainer');

            loadingContainer.style.display = 'block';
            coursewareContainer.style.display = 'none';
            emptyContainer.style.display = 'none';

            const response = await API.Courseware.getByCourse(courseId);

            loadingContainer.style.display = 'none';

            if (response.code === 200) {
                coursewares = response.data || [];

                if (coursewares.length === 0) {
                    showCoursewareEmptyState();
                } else {
                    renderCoursewareList();
                }

                updateCourseInfo();
            } else {
                Utils.showMessage('åŠ è½½è¯¾ä»¶æ•°æ®å¤±è´¥: ' + response.message, 'danger');
                showCoursewareEmptyState();
            }
        } catch (error) {
            document.getElementById('coursewareLoadingContainer').style.display = 'none';
            console.error('Load course coursewares error:', error);
            Utils.showMessage('åŠ è½½è¯¾ä»¶æ•°æ®å¤±è´¥', 'danger');
            showCoursewareEmptyState();
        }
    }

    // æ¸²æŸ“è¯¾ä»¶åˆ—è¡¨
    function renderCoursewareList() {
        const container = document.getElementById('coursewareContainer');

        let html = '<div class="courseware-grid">';

        coursewares.forEach(courseware => {
            const fileInfo = getFileInfo(courseware.title);
            const sizeText = formatFileSize(courseware.fileSize);
            const uploadDate = Utils.formatDate(courseware.uploadTime, 'YYYY-MM-DD HH:mm');

            html += `
                    <div class="courseware-item">
                        <div class="file-icon ${fileInfo.type}">
                            ${fileInfo.icon}
                        </div>
                        <div class="file-content">
                            <div class="file-title" title="${courseware.title}">
                                ${truncateText(courseware.title, 30)}
                            </div>
                            <div class="file-meta">
                                <small class="text-muted">
                                    ${sizeText} | ${uploadDate}
                                </small>
                            </div>
                            <div class="file-actions mt-2">
                                <button class="btn btn-primary btn-sm" onclick="downloadCourseware(${courseware.id}, '${courseware.title}')">
                                    ğŸ“¥ ä¸‹è½½
                                </button>
                                <button class="btn btn-warning btn-sm ml-1" onclick="editCourseware(${courseware.id})">
                                    âœï¸ ç¼–è¾‘
                                </button>
                                <button class="btn btn-danger btn-sm ml-1" onclick="deleteCourseware(${courseware.id})">
                                    ğŸ—‘ï¸ åˆ é™¤
                                </button>
                            </div>
                        </div>
                    </div>
                `;
        });

        html += '</div>';
        container.innerHTML = html;
        container.style.display = 'block';
    }

    // è·å–æ–‡ä»¶ä¿¡æ¯
    function getFileInfo(filename) {
        const ext = filename.split('.').pop().toLowerCase();

        switch (ext) {
            case 'pdf':
                return { type: 'pdf', icon: 'ğŸ“„' };
            case 'ppt':
            case 'pptx':
                return { type: 'ppt', icon: 'ğŸ“Š' };
            case 'doc':
            case 'docx':
                return { type: 'doc', icon: 'ğŸ“' };
            case 'xls':
            case 'xlsx':
                return { type: 'excel', icon: 'ğŸ“ˆ' };
            case 'txt':
                return { type: 'txt', icon: 'ğŸ“ƒ' };
            case 'zip':
            case 'rar':
                return { type: 'archive', icon: 'ğŸ“¦' };
            default:
                return { type: 'other', icon: 'ğŸ“' };
        }
    }

    // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 B';
        const k = 1024;
        const sizes = ['B', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
    }

    // æˆªæ–­æ–‡æœ¬
    function truncateText(text, maxLength) {
        if (text.length <= maxLength) return text;
        return text.substring(0, maxLength) + '...';
    }

    // æ›´æ–°è¯¾ç¨‹ä¿¡æ¯
    function updateCourseInfo() {
        if (!selectedCourse) return;

        document.getElementById('courseCode').textContent = selectedCourse.courseCode;
        document.getElementById('courseCredits').textContent = selectedCourse.credits;
        document.getElementById('coursewareCount').textContent = coursewares.length;

        // è®¡ç®—æ€»æ–‡ä»¶å¤§å°
        const totalSize = coursewares.reduce((sum, cw) => sum + (cw.fileSize || 0), 0);
        document.getElementById('totalFileSize').textContent = `æ€»å¤§å°: ${formatFileSize(totalSize)}`;

        // è¿™é‡Œç®€åŒ–å¤„ç†å­¦ç”Ÿæ•°é‡
        document.getElementById('studentCount').textContent = Math.floor(Math.random() * 50) + 10;

        document.getElementById('courseInfo').style.display = 'block';
        document.getElementById('coursewareCard').style.display = 'block';
    }

    // æ˜¾ç¤ºç©ºçŠ¶æ€
    function showCoursewareEmptyState() {
        document.getElementById('coursewareLoadingContainer').style.display = 'none';
        document.getElementById('coursewareContainer').style.display = 'none';
        document.getElementById('coursewareEmptyContainer').style.display = 'block';
    }

    // ç»‘å®šäº‹ä»¶
    function bindEvents() {
        // è¯¾ç¨‹é€‰æ‹©
        const courseSelect = document.getElementById('courseSelect');
        const uploadBtn = document.getElementById('uploadBtn');

        courseSelect.addEventListener('change', function() {
            const courseId = this.value;
            if (courseId) {
                uploadBtn.disabled = false;
                loadCourseCoursewares(courseId);
            } else {
                uploadBtn.disabled = true;
                selectedCourse = null;
                document.getElementById('courseInfo').style.display = 'none';
                document.getElementById('coursewareCard').style.display = 'none';
            }
        });

        // ä¸Šä¼ æŒ‰é’®
        uploadBtn.addEventListener('click', function() {
            if (selectedCourse) {
                openUploadModal();
            }
        });

        // æ–‡ä»¶é€‰æ‹©
        document.getElementById('coursewareFile').addEventListener('change', handleFileSelect);

        // ç¡®è®¤ä¸Šä¼ 
        document.getElementById('confirmUploadBtn').addEventListener('click', uploadCourseware);

        // ä¿å­˜ç¼–è¾‘
        document.getElementById('saveEditBtn').addEventListener('click', saveEdit);

        // ä¾§è¾¹æ åˆ‡æ¢
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        });
    }

    // æ‰“å¼€ä¸Šä¼ æ¨¡æ€æ¡†
    function openUploadModal() {
        document.getElementById('uploadForm').reset();
        document.getElementById('filePreview').style.display = 'none';
        document.getElementById('uploadProgress').style.display = 'none';
        Utils.showModal(document.getElementById('uploadModal'));
    }

    // å¤„ç†æ–‡ä»¶é€‰æ‹©
    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (!file) {
            document.getElementById('filePreview').style.display = 'none';
            return;
        }

        // æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ50MBé™åˆ¶ï¼‰
        const maxSize = 50 * 1024 * 1024;
        if (file.size > maxSize) {
            Utils.showMessage('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡50MB', 'warning');
            event.target.value = '';
            return;
        }

        // æ˜¾ç¤ºæ–‡ä»¶é¢„è§ˆ
        const fileInfo = getFileInfo(file.name);
        document.getElementById('previewIcon').textContent = fileInfo.icon;
        document.getElementById('previewName').textContent = file.name;
        document.getElementById('previewSize').textContent = formatFileSize(file.size);
        document.getElementById('filePreview').style.display = 'block';

        // è‡ªåŠ¨å¡«å……æ ‡é¢˜ï¼ˆå¦‚æœä¸ºç©ºï¼‰
        const titleInput = document.getElementById('coursewareTitle');
        if (!titleInput.value.trim()) {
            titleInput.value = file.name.replace(/\.[^/.]+$/, ''); // ç§»é™¤æ‰©å±•å
        }
    }

    // ä¸Šä¼ è¯¾ä»¶
    async function uploadCourseware() {
        const form = document.getElementById('uploadForm');
        const fileInput = document.getElementById('coursewareFile');
        const titleInput = document.getElementById('coursewareTitle');

        if (!Utils.validateForm(form)) {
            return;
        }

        if (!fileInput.files[0]) {
            Utils.showMessage('è¯·é€‰æ‹©è¦ä¸Šä¼ çš„æ–‡ä»¶', 'warning');
            return;
        }

        try {
            const confirmBtn = document.getElementById('confirmUploadBtn');
            confirmBtn.disabled = true;

            // æ˜¾ç¤ºä¸Šä¼ è¿›åº¦
            document.getElementById('uploadProgress').style.display = 'block';
            updateProgress(0, 'å¼€å§‹ä¸Šä¼ ...');

            const response = await API.Courseware.upload(
                selectedCourse.id,
                fileInput.files[0],
                titleInput.value.trim()
            );

            if (response.code === 200) {
                updateProgress(100, 'ä¸Šä¼ å®Œæˆï¼');
                Utils.showMessage('è¯¾ä»¶ä¸Šä¼ æˆåŠŸ', 'success');
                closeModal();
                await loadCourseCoursewares(selectedCourse.id);
            } else {
                Utils.showMessage('ä¸Šä¼ å¤±è´¥: ' + response.message, 'danger');
            }
        } catch (error) {
            console.error('Upload courseware error:', error);
            Utils.showMessage('ä¸Šä¼ å¤±è´¥: ' + error.message, 'danger');
        } finally {
            const confirmBtn = document.getElementById('confirmUploadBtn');
            confirmBtn.disabled = false;
            setTimeout(() => {
                document.getElementById('uploadProgress').style.display = 'none';
            }, 2000);
        }
    }

    // æ›´æ–°ä¸Šä¼ è¿›åº¦
    function updateProgress(percent, text) {
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');

        progressBar.style.width = percent + '%';
        progressBar.textContent = percent + '%';
        progressText.textContent = text;
    }

    // ç¼–è¾‘è¯¾ä»¶
    function editCourseware(coursewareId) {
        const courseware = coursewares.find(c => c.id === coursewareId);
        if (!courseware) return;

        document.getElementById('editCoursewareId').value = courseware.id;
        document.getElementById('editTitle').value = courseware.title;

        Utils.showModal(document.getElementById('editModal'));
    }

    // ä¿å­˜ç¼–è¾‘
    async function saveEdit() {
        const form = document.getElementById('editForm');

        if (!Utils.validateForm(form)) {
            return;
        }

        try {
            const saveBtn = document.getElementById('saveEditBtn');
            saveBtn.disabled = true;
            saveBtn.textContent = 'ä¿å­˜ä¸­...';

            const coursewareId = document.getElementById('editCoursewareId').value;
            const title = document.getElementById('editTitle').value.trim();

            const response = await API.Courseware.update(coursewareId, { title });

            if (response.code === 200) {
                Utils.showMessage('è¯¾ä»¶æ›´æ–°æˆåŠŸ', 'success');
                closeEditModal();
                await loadCourseCoursewares(selectedCourse.id);
            } else {
                Utils.showMessage('æ›´æ–°å¤±è´¥: ' + response.message, 'danger');
            }
        } catch (error) {
            console.error('Update courseware error:', error);
            Utils.showMessage('æ›´æ–°å¤±è´¥: ' + error.message, 'danger');
        } finally {
            const saveBtn = document.getElementById('saveEditBtn');
            saveBtn.disabled = false;
            saveBtn.textContent = 'ä¿å­˜';
        }
    }

    // åˆ é™¤è¯¾ä»¶
    function deleteCourseware(coursewareId) {
        const courseware = coursewares.find(c => c.id === coursewareId);
        if (!courseware) return;

        Utils.confirm(
            `ç¡®å®šè¦åˆ é™¤è¯¾ä»¶"${courseware.title}"å—ï¼Ÿ\n\nâš ï¸ åˆ é™¤åæ— æ³•æ¢å¤ï¼`,
            async () => {
                try {
                    const response = await API.Courseware.delete(coursewareId);
                    if (response.code === 200) {
                        Utils.showMessage('è¯¾ä»¶åˆ é™¤æˆåŠŸ', 'success');
                        await loadCourseCoursewares(selectedCourse.id);
                    } else {
                        Utils.showMessage('åˆ é™¤å¤±è´¥: ' + response.message, 'danger');
                    }
                } catch (error) {
                    console.error('Delete courseware error:', error);
                    Utils.showMessage('åˆ é™¤å¤±è´¥: ' + error.message, 'danger');
                }
            }
        );
    }

    // ä¸‹è½½è¯¾ä»¶
    async function downloadCourseware(coursewareId, filename) {
        try {
            Utils.showMessage('å¼€å§‹ä¸‹è½½...', 'info');
            await API.Courseware.download(coursewareId, filename);
            Utils.showMessage('ä¸‹è½½å®Œæˆ', 'success');
        } catch (error) {
            console.error('Download courseware error:', error);
            Utils.showMessage('ä¸‹è½½å¤±è´¥: ' + error.message, 'danger');
        }
    }

    // å…³é—­ä¸Šä¼ æ¨¡æ€æ¡†
    function closeModal() {
        Utils.closeModal();
        document.getElementById('uploadForm').reset();
        document.getElementById('filePreview').style.display = 'none';
        document.getElementById('uploadProgress').style.display = 'none';
    }

    // å…³é—­ç¼–è¾‘æ¨¡æ€æ¡†
    function closeEditModal() {
        Utils.closeModal();
        document.getElementById('editForm').reset();
    }

    // å¯¼å‡ºå‡½æ•°åˆ°å…¨å±€ä½œç”¨åŸŸ
    window.editCourseware = editCourseware;
    window.deleteCourseware = deleteCourseware;
    window.downloadCourseware = downloadCourseware;
    window.closeModal = closeModal;
    window.closeEditModal = closeEditModal;

    // æ·»åŠ æ ·å¼
    const style = document.createElement('style');
    style.textContent = `
            .courseware-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 20px;
            }

            .courseware-item {
                border: 1px solid #e9ecef;
                border-radius: 8px;
                padding: 15px;
                background: white;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 15px;
            }

            .courseware-item:hover {
                border-color: #007bff;
                box-shadow: 0 2px 8px rgba(0, 123, 255, 0.15);
            }

            .file-icon {
                font-size: 32px;
                min-width: 40px;
                text-align: center;
            }

            .file-content {
                flex: 1;
                min-width: 0;
            }

            .file-title {
                font-weight: 600;
                color: #333;
                margin-bottom: 5px;
                word-break: break-word;
            }

            .file-meta {
                margin-bottom: 10px;
            }

            .file-actions .btn {
                font-size: 12px;
                padding: 4px 8px;
            }

            .file-preview-card {
                display: flex;
                align-items: center;
                gap: 15px;
                padding: 15px;
                border: 1px solid #e9ecef;
                border-radius: 8px;
                background: #f8f9fa;
            }

            .file-preview-card .file-icon {
                font-size: 24px;
                min-width: 30px;
            }

            .file-preview-card .file-name {
                font-weight: 600;
                margin-bottom: 5px;
            }

            .file-preview-card .file-size {
                font-size: 12px;
                color: #6c757d;
            }

            .file-icon.pdf { color: #dc3545; }
            .file-icon.ppt { color: #fd7e14; }
            .file-icon.doc { color: #0d6efd; }
            .file-icon.excel { color: #198754; }
            .file-icon.archive { color: #6c757d; }
            .file-icon.other { color: #adb5bd; }

            @media (max-width: 768px) {
                .courseware-grid {
                    grid-template-columns: 1fr;
                }

                .courseware-item {
                    flex-direction: column;
                    text-align: center;
                }

                .file-actions .btn {
                    width: 100%;
                    margin: 2px 0;
                }
            }
        `;
    document.head.appendChild(style);
</script>
</body>
</html>